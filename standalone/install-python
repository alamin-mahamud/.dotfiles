#!/usr/bin/env bash
# Standalone Python development environment installer
# Following Python's Zen: "There should be one obvious way to do it"

set -euo pipefail

# Detect script location
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOTFILES_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

# Check if we're in a dotfiles repository
if [[ ! -d "$DOTFILES_ROOT/lib" ]] || [[ ! -d "$DOTFILES_ROOT/recipes" ]]; then
    echo "Error: Not in a dotfiles repository structure"
    echo "This script should be run from a cloned dotfiles repository"
    exit 1
fi

# Import required libraries
source "$DOTFILES_ROOT/lib/core.sh"
source "$DOTFILES_ROOT/lib/os.sh"
source "$DOTFILES_ROOT/lib/package.sh"

# Main execution
main() {
    info "=== Standalone Python Development Installer ==="
    
    # Check prerequisites
    if ! check_internet; then
        die "Internet connection required"
    fi
    
    # Run the Python recipe
    local recipe="$DOTFILES_ROOT/recipes/python.sh"
    if [[ -x "$recipe" ]]; then
        "$recipe"
    else
        die "Python recipe not found or not executable: $recipe"
    fi
    
    success "=== Python development environment installation complete! ==="
    info "Please restart your terminal or run: source ~/.python_env"
}

main "$@"